# 测试设计：1.1 Yarn 3 Workspaces 与 Node 20 LTS

日期：2025-09-22｜设计者：Quinn

## 场景（总数：8｜单元：3｜集成：5）

AC1：`.yarnrc.yml` 与 Workspaces 配置到位
| ID           | 层级 | 优先级 | 测试内容                                                       |
|--------------|------|--------|----------------------------------------------------------------|
| 1.1-INT-001  | 集成 | P0     | 存在 `.yarnrc.yml` 且 `nodeLinker: node-modules` 生效           |
| 1.1-INT-002  | 集成 | P0     | 根 `packageManager` 指定 `yarn@3.x`；`yarn workspaces list` 发现 apps/*、packages/* |
| 1.1-UNIT-001 | 单元 | P1     | `.yarnrc.yml` 解析器：关键键值（nodeLinker）校验               |

AC2：CI 缓存与锁文件稳定性
| 1.1-INT-003  | 集成 | P0     | CI 执行 `corepack enable` + 缓存 Yarn/Node；缓存命中率>0       |
| 1.1-INT-004  | 集成 | P0     | `yarn install --immutable`：锁文件偏离时流水线失败             |
| 1.1-UNIT-002 | 单元 | P1     | `package.json` engines.node ≥ 20 校验                          |
| 1.1-UNIT-003 | 单元 | P1     | 构建脚本中包含 `corepack enable` 或等效初始化步骤              |
| 1.1-INT-005  | 集成 | P1     | `yarn workspaces list --json` 输出工作区并在 CI 中记录审计       |

```yaml
test_design:
  scenarios_total: 8
  by_level: { unit: 3, integration: 5 }
  by_priority: { p0: 4, p1: 4 }
  coverage_gaps: []
```

