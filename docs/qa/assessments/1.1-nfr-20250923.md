# NFR 快速评估：1.1 Yarn 3 Workspaces 与 Node 20 LTS

日期：2025-09-23｜评审：Quinn

## 结论概览

- 评估范围：Security, Performance, Reliability, Maintainability
- 质量分：100（全部 PASS）
- 关键结论：CI 已记录缓存命中与安装耗时，nodeLinker / workspaces 具备自动守护，测试脚本提供最小 smoke 校验。

## 评估详情

### Security — PASS
- 证据：`.github/workflows/quality.yml` 中 `security` job 持续执行 `gitleaks` 与 `osv-scanner`；新增守护未改变此保障。
- 风险缓解：`git diff --exit-code yarn.lock` 以及新的 `reports/yarn-cache.txt` 共同确保锁文件与依赖一致性。
- TODO：定期升级扫描器版本，保持规则最新。

### Performance — PASS
- 现状：`Install dependencies (immutable)` 步骤记录 `yarn_install_seconds` 并写入 `reports/yarn-install-metrics.txt`；`Record Yarn cache metadata` 将 `cache-hit` 状态汇总至 `reports/yarn-cache.txt`。
- 风险：如缓存策略调整，可通过构件追溯变化。
- 建议：按需将该指标纳入长期观测（可上传至仪表盘）。

### Reliability — PASS
- 现状：`Verify Yarn config guards` 步骤在 CI 中断言 nodeLinker，为 `.yarnrc.yml` 提供自动守护；同一步骤保存 `reports/workspaces.json` 并运行 `scripts/workspace-smoke.cjs` 校验所有工作区。
- 风险：一旦配置漂移，CI 将立即失败并在构件中保留上下文。
- 建议：新增工作区时同步更新 smoke 脚本映射。

### Maintainability — PASS
- 现状：`scripts/workspace-smoke.cjs` 提供最小 smoke，并由 `yarn test:web` / `yarn test:api` 调用；文档步骤与脚本形成闭环。
- 风险：随着仓库扩展，需要将新工作区纳入映射。
- 建议：可扩展脚本支持 CLI 参数批量校验，保持一致性。

## 行动建议

1. 持续监控 `reports/yarn-install-metrics.txt` 与 `reports/yarn-cache.txt`，必要时纳入 SLO 观测。
2. 新增工作区或脚手架时同步更新 `scripts/workspace-smoke.cjs` 与 CI 守护。
3. 若后续引入真实服务测试，可在 smoke 脚本基础上扩展更丰富的集成流程。
