# 测试设计：故事 1.4 Prisma 基线与迁移

日期：2025-09-22
设计者：Quinn（测试架构师）

## 策略概览

- 场景总数：7｜单元：2｜集成：4｜端到端：1
- 关注：迁移可重复、回滚可验证、索引有效性

## 按验收标准分解

AC1：初始化 `prisma/schema.prisma`；创建首个迁移

| ID           | 层级 | 优先级 | 测试内容                            | 依据          |
|--------------|------|--------|-------------------------------------|---------------|
| 1.4-UNIT-001 | 单元 | P1     | schema 语法与模型完整性检查         | 静态校验      |
| 1.4-INT-001  | 集成 | P0     | 生成并应用首个迁移（空库→目标）     | 迁移成功性    |

AC2：`requirements/metrics/rbom_nodes/...` 最小表与索引

| ID           | 层级 | 优先级 | 测试内容                            | 依据          |
|--------------|------|--------|-------------------------------------|---------------|
| 1.4-INT-002  | 集成 | P0     | 核心表存在与主键/唯一/索引生效      | 元数据校验    |
| 1.4-INT-003  | 集成 | P1     | 典型查询 Explain 评估（示例脚本）    | 性能基线      |

AC3：CI 执行 migrate + 回滚用例

| ID           | 层级 | 优先级 | 测试内容                            | 依据          |
|--------------|------|--------|-------------------------------------|---------------|
| 1.4-INT-004  | 集成 | P0     | CI 中执行 `migrate deploy`          | 可重复性      |
| 1.4-E2E-001  | E2E  | P1     | 演练一次向前迁移 + 回滚（脚本化）   | 可恢复性      |

```yaml
test_design:
  scenarios_total: 7
  by_level: { unit: 2, integration: 4, e2e: 1 }
  by_priority: { p0: 3, p1: 4 }
  coverage_gaps: []
```

