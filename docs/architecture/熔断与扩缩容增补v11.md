# 熔断与扩缩容增补（v1.1）

## 熔断/降级（DOORS/OA 适配器）
```ts
import CircuitBreaker from 'opossum';
const doorsCall = (payload: any) => http.post(DOORS_URL, payload, { timeout: 5000 });
const breaker = new CircuitBreaker(doorsCall, { timeout: 6000, errorThresholdPercentage: 50, volumeThreshold: 10, resetTimeout: 30000 });
breaker.fallback(() => ({ ok: false, reason: 'degraded', ticket: createOfflineTicket() }));
```
触发条件：错误率≥50% 或超时；恢复：30s 后半开；降级：转离线工单/缓存结果，告警并提示重试窗口。

## 负载均衡与扩缩容触发
- 健康检查：`/api/__health_check` 返回 200 与版本/时区
- 触发阈值（示例）：
  - API CPU > 70% 持续 5 分钟 或 P95 > 800ms
  - 队列滞留 > 60s 或 backlog > 1000（按队列）
- Render/Railway：开启自动扩缩，min=1，max=5；K8s 可使用 HPA（CPU/自定义指标）

---
