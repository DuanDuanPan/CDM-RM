# 测试设计：故事 1.3

日期：2025-09-22
设计者：Quinn（测试架构师）

## 策略概览

- 测试场景总数：9
- 单元：5（56%）
- 集成：3（33%）
- 端到端：1（11%）
- 优先级分布：P0：5，P1：3，P2：1

## 按验收标准分解

AC1：web 使用 Vitest；api 使用 Jest/Vitest（二选一）

| ID           | 测试层级   | 优先级 | 测试内容                                      | 依据                               |
| ------------ | ---------- | ------ | --------------------------------------------- | ---------------------------------- |
| 1.3-UNIT-001 | 单元       | P0     | Web 端纯函数示例在 Vitest 下可运行            | 验证框架接线（web）                |
| 1.3-UNIT-002 | 单元       | P0     | API 端示例在 Jest/Vitest 下可运行             | 验证框架接线（api）                |
| 1.3-INT-001  | 集成       | P1     | API 服务集成测试（DB mock）                   | 验证集成边界                       |

AC2：`yarn test:client`/`yarn test:server` 与覆盖率通过

| ID           | 测试层级   | 优先级 | 测试内容                                      | 依据                               |
| ------------ | ---------- | ------ | --------------------------------------------- | ---------------------------------- |
| 1.3-UNIT-003 | 单元       | P0     | 启用并生成覆盖率报告                          | 建立覆盖率采集基线                 |
| 1.3-INT-002  | 集成       | P0     | CI 执行 test 脚本（1× 矩阵）                  | 契约：CI 必跑强制测试              |
| 1.3-E2E-001  | 端到端     | P2     | 最小 API 路由冒烟（如有 server）               | 可选端到端健全性                   |

AC3：CI 启动最小测试矩阵

| ID           | 测试层级   | 优先级 | 测试内容                                      | 依据                               |
| ------------ | ---------- | ------ | --------------------------------------------- | ---------------------------------- |
| 1.3-UNIT-004 | 单元       | P1     | Node 20 矩阵执行测试                          | 防止版本漂移                       |
| 1.3-INT-003  | 集成       | P1     | 安装+测试的缓存命中                           | 保证缓存有效                       |
| 1.3-UNIT-005 | 单元       | P0     | 覆盖率低于门槛即失败                          | 强制覆盖率门槛                     |

## 风险覆盖

- 缓解：TECH-003（无测试）、OPS-003（CI 未测）、PERF-002（无阈值）

## 建议执行顺序

1. P0 单元 → 1.3-UNIT-001/002/003/005
2. P0 集成 → 1.3-INT-002
3. P1 单元/集成 → 1.3-UNIT-004，1.3-INT-003
4. P2 端到端 → 1.3-E2E-001

```yaml
test_design:
  scenarios_total: 9
  by_level: { unit: 5, integration: 3, e2e: 1 }
  by_priority: { p0: 5, p1: 3, p2: 1 }
  coverage_gaps: []
```
