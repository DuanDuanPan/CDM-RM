# NFR 评估：1.5 Swagger/OpenAPI 导出

日期：2025-09-28
评审人：Quinn（Test Architect）

## 摘要
- 安全：CONCERNS（Swagger 路由默认公开，需要鉴权/脱敏策略防止内部端点泄露）
- 性能：PASS（契约导出为一次性操作，冷启动生成 < 5s，运行时提供缓存即可满足响应要求）
- 可靠性：CONCERNS（contracts 流水线缺少稳定性监控，`/api/__openapi.json` 需纳入健康检查并设置失败告警）
- 可维护性：PASS（脚本与 README/Runbook 已规划更新，生成产物纳入 CI，维护流程清晰）
- 质量分数：80/100（2 项 CONCERNS，每项扣 10 分）

## 细项评估
### 安全（CONCERNS）
- 证据：Spectral 规则与单元测试会检查 `servers`、tag 白名单。
- 缺口：尚未明确 `/api/__openapi.json` 是否要求平台级鉴权；需要确保隐藏内部模块、敏感示例数据。
- 行动：为路由添加访问控制；在 Spectral 配置中启用敏感字段检测；审查 DocumentBuilder include/exclude 列表。

### 性能（PASS）
- 证据：OpenAPI 文档生成基于 Nest `SwaggerModule`，主要 CPU 负载在冷启动；类型/客户端生成仅在 CI 与开发者操作中执行。
- 风险：若 contracts 作业冷缓存执行，需确保 Turborepo reuse 正常，但对性能影响可接受。
- 行动：无阻断性动作，建议在 README 中记录期望执行时间供回归参考。

### 可靠性（CONCERNS）
- 证据：计划将契约导出纳入 `quality.yml`，并通过 E2E 流水线验证。
- 缺口：缺少 contracts 作业失败率与耗时的自动化监控；`/api/__openapi.json` 尚未纳入现有健康检查。
- 行动：新增 GitHub Actions/Datadog 指标上报；在健康检查脚本中增加 OpenAPI 路由验证并配置告警阈值。

### 可维护性（PASS）
- 证据：`scripts/export-openapi.js`、`api:types`、`api:client` 生成流程有明确脚本；Diff/Spectral 工件上传到 CI；PR 模板计划提示更新基线。
- 风险：需确保前端禁止手写 REST 的 ESLint 规则随生成客户端一并维护。
- 行动：保持 README、Runbook、PR 模板同步；定期审查 Spectral 规则白名单。

```yaml
# Gate YAML (复制到 gate 文件)
nfr_validation:
  _assessed: [security, performance, reliability, maintainability]
  security:
    status: CONCERNS
    notes: 'Swagger 路由需鉴权与敏感字段过滤，避免暴露内部 API 信息'
  performance:
    status: PASS
    notes: '契约生成成本低，冷启动 <5s；可通过缓存响应保障运行时性能'
  reliability:
    status: CONCERNS
    notes: 'contracts 流水线缺少稳定性监控，OpenAPI 路由尚未纳入健康检查告警'
  maintainability:
    status: PASS
    notes: '脚本/文档流程清晰，生成产物纳入 CI；需与 ESLint/PR 模板同步维护'
```

NFR assessment: qa.qaLocation/assessments/1.5-nfr-20250928.md
