# Requirements Traceability Matrix

## Story: 1.2 - 代码规范与提交检查

### Coverage Summary

- Total Requirements: 3
- Fully Covered: 3 (100%)
- Partially Covered: 0 (0%)
- Not Covered: 0 (0%)

### Requirement Mappings

#### AC1: ESLint 规则（TS/React/Promise/Prettier）；Prettier 单引号/120 列

- **Coverage: FULL**
- test_mappings:
  - test_file: '.github/workflows/quality.yml'
    test_case: 'contracts job :: lint & prettier gates'
    given: 'Quality Gates workflow runs on push/PR'
    when: 'steps `yarn lint` 与 `yarn prettier:check` 执行共享配置 (`packages/config/eslint.config.js`, `prettier.config.cjs`)' 
    then: 'TS/React/Promise/Prettier 插件启用且单引号/120 列策略通过 CI 强制'
    coverage: integration
  - test_file: 'packages/config/prettier.config.cjs'
    test_case: 'prettier 基线配置'
    given: '读取共享 Prettier 配置'
    when: '检查 `singleQuote: true` 与 `printWidth: 120`'
    then: '格式化策略符合架构要求'
    coverage: unit
  - test_file: 'packages/config/eslint.config.js'
    test_case: 'eslint 插件集合'
    given: '加载 ESLint 平台配置'
    when: '聚合 TS/React/React Hooks/Promise/Prettier 规则'
    then: 'lint 命令覆盖所有指定生态并以 `prettier/prettier` error 约束格式'
    coverage: unit

#### AC2: Husky pre-commit：eslint --fix + prettier -w；commitlint 检查 type/scope

- **Coverage: FULL**
- test_mappings:
  - test_file: '.husky/pre-commit'
    test_case: 'pre-commit 自动修复'
    given: '开发者执行 `git commit`'
    when: 'Husky 运行 `npx lint-staged`，触发 `eslint --fix` 与 `prettier --write`'
    then: '未格式化代码被自动修复或拒绝提交'
    coverage: integration
  - test_file: 'package.json'
    test_case: 'lint-staged 模式'
    given: 'lint-staged 通过 Husky 调用'
    when: '匹配 `{apps,packages,scripts}` 下的 TS/JS/JSON/MD 文件'
    then: '执行 eslint --fix 与 prettier --write，确保提交内容符合规范'
    coverage: unit
  - test_file: '.husky/commit-msg'
    test_case: 'commitlint 校验'
    given: '同一次提交写入 message'
    when: '执行 `npx commitlint --edit "$1"` 或 CI 烟雾测试管道'
    then: 'type/scope/subject 规则违反时提交中止'
    coverage: integration
  - test_file: '.github/workflows/quality.yml'
    test_case: 'CI smoke 验证 lint-staged/commitlint'
    given: 'Quality Gates workflow 执行 contracts job'
    when: '运行 “Smoke test lint-staged” 与 “Smoke test commitlint” 步骤'
    then: 'CI 环境验证钩子配置未失效，满足提交守卫要求'
    coverage: integration

#### AC3: 提交信息与 PR 模板就位

- **Coverage: FULL**
- test_mappings:
  - test_file: '.github/PULL_REQUEST_TEMPLATE.md'
    test_case: 'PR 自检清单'
    given: '贡献者创建 Pull Request'
    when: 'GitHub 渲染模板并提示 lint/format/test/coverage 勾选'
    then: '协作流程包含必需的验证提示'
    coverage: integration
  - test_file: 'README.md'
    test_case: '开发流程文档'
    given: '工程成员查看 README 的“开发流程”段落'
    when: '阅读 Conventional Commits 要求与 pre-commit 流程说明'
    then: '提交规范对齐并链接至 CI 质量门槛'
    coverage: unit

### Critical Gaps

- 无

### Test Design Recommendations

- Quality Gates 已包含一次性 lint-staged/commitlint 烟雾测试；后续若扩展目录，可在烟雾脚本中追加样例文件路径。
- 为 `scripts/workspace-smoke.cjs` 增加 optional 参数，未来可扩展到 worker/shared smoke，加固 PR 模板提到的测试脚本。

### Risk Assessment

- **Low Risk**: CI 与本地均执行 lint/format/commit 守卫；需持续维护 lint-staged 模式以覆盖新增目录。

### Trace Hook

Trace matrix: docs/qa/assessments/1.2-trace-20250923.md
